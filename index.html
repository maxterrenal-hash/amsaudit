<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"><title>AMS Audit</title><style>:root{--bg:#0b1020;--panel:#0f172a;--ink:#e5e7eb;--ink2:#a7b0be;--bd:#2a3343;--card:#0b1224;--acc:#22d3ee;--acc2:#06b6d4;--r:14px}*{box-sizing:border-box}html,body{height:100%;color-scheme:dark}body{margin:0;font:14px/1.4 'Inter',ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--ink);background:radial-gradient(1200px 700px at 80% -10%,#0e1a33 0%,var(--bg) 55%)}.wrap{max-width:1100px;margin:32px auto;padding:0 16px 80px}.row{display:grid;gap:12px}.c2,.c3,.c4{grid-template-columns:1fr}@media(min-width:640px){.c2{grid-template-columns:repeat(2,1fr)}}@media(min-width:860px){.c3{grid-template-columns:repeat(3,1fr)}.two{grid-template-columns:1fr 1fr}}@media(min-width:1024px){.c4{grid-template-columns:repeat(4,1fr)}}header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.title{font:700 22px/1 'Inter',ui-sans-serif}.btn{appearance:none;border:1px solid var(--bd);background:linear-gradient(180deg,#0f1b33,#0d162a);color:var(--ink);padding:10px 14px;border-radius:10px;cursor:pointer}.btn.p{border-color:transparent;background:linear-gradient(180deg,var(--acc),var(--acc2));color:#04121a;font-weight:700}.card{background:linear-gradient(180deg,var(--panel),#0c1427);border:1px solid var(--bd);border-radius:var(--r);padding:16px;margin:12px 0 18px;box-shadow:0 10px 24px rgba(0,0,0,.25),inset 0 1px 0 rgba(255,255,255,.02)}h2{margin:0 0 10px;font:800 16px/1.1 'Inter',ui-sans-serif}label{display:block;font-size:12px;color:var(--ink2);margin:0 0 6px}.req:after{content:" *";color:#ef4444}input,select,textarea{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--bd);background:linear-gradient(180deg,#0c1427,#0a1222);color:var(--ink);outline:none;font-size:16px;height:48px}textarea{min-height:76px;height:auto;resize:vertical}select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 7l5 5 5-5' stroke='%23a7b0be' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:36px}option{background:#0a1222;color:var(--ink)}input[type=date]::-webkit-calendar-picker-indicator{filter:invert(1) opacity(.85)}.chip{display:inline-flex;gap:8px;padding:8px 10px;border-radius:999px;background:#0c1a2d;border:1px solid var(--bd);color:var(--ink2);font-size:12px}.acc{border:1px solid var(--bd);border-radius:12px;overflow:hidden;background:var(--card)}.acc-item{border-top:1px solid var(--bd)}.acc-h{display:flex;align-items:center;justify-content:space-between;width:100%;background:transparent;border:0;color:var(--ink);padding:14px 16px;cursor:pointer;text-align:left;font-size:16px}.acc-b{padding:14px;display:none}.open>.acc-b{display:block}.pill{padding:4px 8px;border-radius:999px;background:#0c1a2d;border:1px solid var(--bd);font-size:11px}.hidden{display:none!important}.overlay{position:fixed;inset:0;background:rgba(3,6,12,.75);display:flex;align-items:center;justify-content:center;z-index:50}.panel{width:min(900px,92vw);max-height:78vh;overflow:auto;background:#0b1224;border:1px solid var(--bd);border-radius:12px;padding:16px}.tests{margin-top:10px;font-size:12px;color:var(--ink2)}</style></head><body><div class="wrap"><header><div class="title">AMS Audit</div><div><button class="btn" id="reset">Reset</button> <button class="btn p" id="submit">Submit</button></div></header><section class="card" id="sec-audit"><h2>Audit Information</h2><div class="row c2" id="audit-grid"></div></section><section class="card" id="sec-patient"><h2>Patient Information</h2><div class="row c4" id="patient-grid"></div></section><section class="card" id="sec-dx"><h2>Diagnostics & Biomarkers</h2><div class="row c3" id="dx-grid-1"></div><div class="row c2" style="margin-top:12px" id="dx-grid-2"></div></section><section class="card"><h2>Antimicrobials (up to 5)</h2><div class="acc" id="abx"></div></section><section class="card"><h2>Microorganisms & Resistance</h2><div class="row two" id="micro"></div></section><section class="card"><h2>Recent History</h2><div class="row c2" id="hist"></div></section><div style="display:flex;gap:8px;justify-content:flex-end"><span class="chip">Validates before sending</span><button class="btn" id="preview">Preview JSON</button><button class="btn p" id="submit2">Submit</button></div><div class="tests" id="tests"></div></div><div class="overlay hidden" id="ov"><div class="panel"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><strong>Payload Preview</strong><button class="btn" id="ovx">Close</button></div><pre id="ovpre" style="white-space:pre-wrap;word-break:break-word"></pre></div></div><script>(()=>{"use strict";const $=s=>document.querySelector(s),E=(t,a,k)=>{const n=document.createElement(t);if(a&&!(a instanceof Node)&&!Array.isArray(a)&&typeof a!="string"){for(const [p,v]of Object.entries(a)){if(p==="class")n.className=v;else if(p==="html")n.innerHTML=v;else if(v!=null)n.setAttribute(p,String(v))}}else{k=a;a={}}if(k!=null)(Array.isArray(k)?k:[k]).forEach(ch=>n.appendChild(ch instanceof Node?ch:document.createTextNode(String(ch))));return n},fill=(sel,opts,ph="Select")=>{if(!sel)return;sel.innerHTML="";sel.appendChild(E("option",{value:""},ph));(opts||[]).forEach(v=>sel.appendChild(E("option",{value:String(v)},String(v))))},val=sel=>{const el=$(sel);return el?el.value:""},today=()=>new Date().toISOString().slice(0,10);const URL="https://script.google.com/macros/s/AKfycbyosAIkrjnjDqW2JhMpWm8N1kJsd5vZXHf4vOm_3Dmn-FuXsgkajn4so-_9nXsFDpR-/exec";const AREAS=["OBGyne Ward","NICU","PICU","Medicine Ward","Surgery Ward","Dengue Ward","Adult Cohort","Pedia Ward","ICU","6th Floor Ward","7th Floor Ward","Oncology Ward","Infectious Ward"];const IND=["Community-Acquired Infection","Healthcare Associated Infection","Surgical Prophylaxis","Medical Prophylaxis","Others","Unknown"],HAI=["CRBSI","VAP","CAUTI","HAP","CDAD","MDRO"],RES=["MRSA","MRCoNS","PNSP","MLS","VRE","ESBL","3GCREB","CRE","ESBL-NF","CR-NF","other MDRO"],MISS=["stock out","could not purchase","patient refused","other reason","multiple reasons","unknown"],MON=["Imipenem","Meropenem","Ertapenem","Doripenem","Gentamicin","Amikacin","Ciprofloxacin","Levofloxacin","Moxifloxacin","Aztreonam","Ceftolozane-Tazobactam","Colistin","Linezolid","Tigecycline","Vancomycin","Cefepime"],RESI=["Ciprofloxacin","Levofloxacin","Moxifloxacin","Ceftriaxone","Cefotaxime","Ceftazidime","Cefixime","Cefpodoxime","Gentamicin","Amikacin","Clindamycin"],DIAGP=["Therapeutic","Prophylaxis","Neonates"],THER={"CNS":[],"EYE":[],"ENT":["ENT","AOM"],"RESP":["LUNG","URTI","Bron","Pneu","COVID-19","TB","CF"],"CVS":[],"GI":["GI","IA","CDIF"],"SSTBJ":["SST","BJ"],"UTI":["Cys","Pye","ASB"],"GUOB":["OBGY","GUM","Syph"],"No defined site.":["BAC","SEPSIS","Malaria","HIV","PUO","PUO-HO","FN","LYMPH","Sys-DI","Other","UNK","PROK"]},PROPH=["CNS","EYE","ENT","RESP","CVS","GI","SSTBJ","UTI","GUOB","No defined site."],NEO=["MP-MAT","NEO-MP","CLD"];const SCHEMA=[{sec:"#audit-grid",rows:[{id:"auditor",lab:"Auditor",req:1,type:"select",opts:["Max","Micha","Miko","Belle","Michael"]},{id:"area",lab:"Area",req:1,type:"select",opts:AREAS},{id:"date",lab:"Date",req:1,type:"date"},{id:"shift",lab:"Shift",req:1,type:"select",opts:["6 to 2","2 to 10","10 to 6"]}]},{sec:"#patient-grid",rows:[{id:"hospNo",lab:"Hospital Number",req:1,type:"text"},{id:"ageYears",lab:"Age (Years)",hint:"≥ 2",type:"number",min:0,step:1},{id:"ageMonths",lab:"Age (Months)",hint:"1–23",type:"number",min:1,max:23,step:1},{id:"ageDays",lab:"Age (Days)",hint:"< 1 mo",type:"number",min:0,max:30,step:1}]},{sec:"#dx-grid-1",rows:[{id:"bioYN",lab:"Treatment based on biomarker or WBC?",req:1,type:"select",opts:["No","Yes"]},{id:"bioType",lab:"Biomarker",type:"select",opts:["CRP","PCT","WBC","Others"],dis:1,other:"bioTypeOther"},{id:"bioFluid",lab:"Fluid sample",type:"select",opts:["Blood","Urine","Others"],dis:1,other:"bioFluidOther"}]},{sec:"#dx-grid-2",rows:[{id:"cultDone",lab:"Culture done?",req:1,type:"select",opts:["No","Yes"]},{id:"cultType",lab:"Specimen",type:"select",opts:["Blood","Urine","Stool","CSF","Wound","Sputum.Bronchial aspirate","Other"],dis:1,other:"cultTypeOther"}]},{sec:"#hist",rows:[{id:"prevHosp",lab:"Previous hospitalization < 3 months",req:1,type:"select",opts:["Yes-ICU","Yes-Other","No","Unknown"]},{id:"prevAbx",lab:"Previous antibiotic course < 1 month",req:1,type:"select",opts:["Yes","No","Unknown"]}]}];function field(f){const w=E("div"),lab=E("label",{class:f.req?"req":""},[f.lab+(f.hint?` \u00A0(${f.hint})`:"")]);let input;if(f.type==="select"){input=E("select",{id:f.id});fill(input,f.opts||[]);if(f.dis)input.disabled=true}else if(f.type==="date"){input=E("input",{id:f.id,type:"date"})}else{input=E("input",{id:f.id,type:f.type||"text"});if(f.min!=null)input.min=f.min;if(f.max!=null)input.max=f.max;if(f.step!=null)input.step=f.step}w.append(lab,input);if(f.other){const o=E("input",{id:f.other,placeholder:"Specify",class:"hidden"});w.append(o)}return w}function render(){SCHEMA.forEach(s=>{const g=$(s.sec);if(!g)return;s.rows.forEach(r=>g.appendChild(field(r)))});$("#date").value=today();const abx=$("#abx");for(let i=0;i<5;i++)abx.appendChild(card(i));const m=$("#micro");for(let i=0;i<3;i++)m.appendChild(mcard(i))}function labsel(id,lab,req,opts,onChange,disabled){const w=E("div"),l=E("label",{class:req?"req":""},lab),s=E("select",{id});fill(s,opts);if(disabled)s.disabled=true;if(onChange)s.addEventListener("change",onChange);w.append(l,s);return w}function labinp(id,lab,req,type,attrs){const w=E("div"),l=E("label",{class:req?"req":""},lab),i=E("input",Object.assign({id,type:type||"text"},attrs||{}));w.append(l,i);return w}function wrap(id,children){const d=E("div",{id});(children||[]).forEach(c=>d.append(c));return d}function mcard(i){const c=E("div",{class:"card",style:"margin:0"}),g=E("div",{class:"row c3"});g.append(labinp(`micro_${i}_org`,`Organism`,0,"text"),labsel(`micro_${i}_res`,`Resistance type`,0,RES),labinp(`micro_${i}_note`,`Notes`,0,"text"));c.append(E("div",{style:"margin:0 0 8px;font-weight:600"},`Microorganism ${i+1}`),g);return c}function drugFill(i,cls){const s=$(`#abx_${i}_drug`);fill(s,cls==="Monitored"?MON:cls==="Restricted"?RESI:[])}function updDiag(i){const p=val(`#abx_${i}_diagP`),s=$(`#abx_${i}_diagS`),sub=$(`#abx_${i}_diagSub`);if(!s||!sub)return;s.disabled=false;sub.disabled=true;sub.innerHTML="";fill(s,p==="Therapeutic"?Object.keys(THER):p==="Prophylaxis"?PROPH:p==="Neonates"?NEO:[]);s.onchange=()=>{const arr=(p==="Therapeutic"?THER[s.value]:{})[s.value]||[];sub.disabled=!(arr&&arr.length);fill(sub,arr)}}function toggleHAI(i){const ind=val(`#abx_${i}_ind`),w=$(`#abx_${i}_haiWrap`);if(w)w.classList.toggle("hidden",ind!=="Healthcare Associated Infection")}function biomarkerWire(){const yn=$("#bioYN"),bt=$("#bioType"),bf=$("#bioFluid"),bto=$("#bioTypeOther"),bfo=$("#bioFluidOther");yn.addEventListener("change",e=>{const on=e.target.value==="Yes";[bt,bf].forEach(x=>x.disabled=!on);bto.classList.toggle("hidden",!(on&&bt.value==="Others"));bfo.classList.toggle("hidden",!(on&&bf.value==="Others"))});bt.addEventListener("change",e=>bto.classList.toggle("hidden",e.target.value!=="Others"));bf.addEventListener("change",e=>bfo.classList.toggle("hidden",e.target.value!=="Others"))}function cultureWire(){const cd=$("#cultDone"),ct=$("#cultType"),cto=$("#cultTypeOther");cd.addEventListener("change",e=>{const on=e.target.value==="Yes";ct.disabled=!on;cto.classList.toggle("hidden",!(on&&ct.value==="Other"))});ct.addEventListener("change",e=>cto.classList.toggle("hidden",e.target.value!=="Other"))}function areaInit(){fill($("#area"),AREAS)}function missedBlock(i){const w=E("div",{style:"grid-column: span 2;"}),g=E("div",{class:"row c2"}),n=labinp(`abx_${i}_miss`,`N missed dose`,0,"number",{min:0,step:1}),why=selWhy(i);g.append(n,why);setTimeout(()=>{const nn=$(`#abx_${i}_miss`),ss=$(`#abx_${i}_missWhy`),tg=()=>{const v=+nn.value||0;ss.disabled=v<=0;if(v<=0)ss.value=""};nn.addEventListener("input",tg);tg()});w.append(g);return w}function selWhy(i){const w=E("div"),l=E("label",{},"Reason"),s=E("select",{id:`abx_${i}_missWhy`});fill(s,MISS);w.append(l,s);return w}function accRow1(i){return E("div",{class:"row c3"},[labsel(`abx_${i}_class`,`Monitored or Restricted`,1,["Monitored","Restricted"],ev=>drugFill(i,ev.target.value)),labsel(`abx_${i}_drug`,`Antimicrobial`,1,[]),labinp(`abx_${i}_start`,`Start date`,1,"date")])}function accRow2(i){return E("div",{class:"row c4",style:"margin-top:12px"},[labinp(`abx_${i}_dose`,`Single Unit Dose`,1,"number",{min:0,step:0.001}),labsel(`abx_${i}_unit`,`Unit`,1,["g","mg","IU","MU"]),labinp(`abx_${i}_perday`,`Doses/day`,1,"number",{min:0,step:1}),labsel(`abx_${i}_route`,`Route`,1,["IM","IV","O","R"])])}function accRow3(i){return E("div",{class:"row c3",style:"margin-top:12px"},[labsel(`abx_${i}_diagP`,`Diagnosis`,1,DIAGP,()=>updDiag(i)),labsel(`abx_${i}_diagS`,`System / Site`,0,[],null,true),labsel(`abx_${i}_diagSub`,`Sub-site / Specific`,0,[],null,true)])}function accRow4(i){const row=E("div",{class:"row",style:"margin-top:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))"});const haiWrap=wrap(`abx_${i}_haiWrap`,[labsel(`abx_${i}_hai`,`HAI subtype`,0,HAI)]);haiWrap.classList.add("hidden");row.append(labsel(`abx_${i}_ind`,`Type of Indication`,1,IND,()=>toggleHAI(i)),haiWrap,labsel(`abx_${i}_reason`,`Reason in note?`,1,["Yes","No"]),labsel(`abx_${i}_guide`,`Guidelines Compliance`,1,["Yes","No","No Local Guidelines","No information"]),labsel(`abx_${i}_stop`,`Stop/Review Date Documented?`,1,["Yes","No"]));return row}function abxRow5(i){return E("div",{class:"row c3",style:"margin-top:12px"},[missedBlock(i),labsel(`abx_${i}_treat`,`Treatment`,1,["Empirical","Targeted"])])}function card(i){const it=E("div",{class:"acc-item"+(i?"":" open")}),h=E("button",{class:"acc-h",type:"button"},[E("span",{class:"name"},`Antimicrobial ${i+1}`),E("span",{class:"pill"},i?"Collapsed":"Expanded")]);h.addEventListener("click",()=>it.classList.toggle("open"));const b=E("div",{class:"acc-b"});b.append(accRow1(i),accRow2(i),accRow3(i),accRow4(i),abxRow5(i));it.append(h,b);return it}function tests(){const out=[];try{E("label","OK");out.push("✓ element")}catch(e){out.push("✗ element "+e)}try{const t=document.createElement("div");t.appendChild(card(0));out.push("✓ card")}catch(e){out.push("✗ card "+e)}document.getElementById("tests").textContent="Tests: "+out.join(" | ")}function payload(){const audit={auditor:val("#auditor").trim(),area:val("#area"),date:val("#date"),shift:val("#shift")};if(!audit.auditor)return alert("Auditor is required."),null;if(!audit.area)return alert("Area is required."),null;if(!audit.date)return alert("Date is required."),null;if(!audit.shift)return alert("Shift is required."),null;const ay=val("#ageYears"),am=val("#ageMonths"),ad=val("#ageDays"),filled=[ay,am,ad].filter(x=>String(x).trim()!=='').length;if(filled!==1)return alert("Provide age in Years OR Months OR Days (exactly one)."),null;const years=ay?+ay:"",months=am?+am:"",days=ad?+ad:"";if(years!==""&&years<2)return alert("Years is for ≥ 2 years only."),null;if(months!==""&&(months<1||months>23))return alert("Months must be 1–23."),null;if(days!==""&&(days<0||days>30))return alert("Days must be 0–30."),null;const bioYN=val("#bioYN")||"No",bioType=$("#bioType").disabled?"":val("#bioType"),bioTypeOther=!$("#bioType").disabled&&val("#bioType")==="Others"?val("#bioTypeOther").trim():"",bioFluid=$("#bioFluid").disabled?"":val("#bioFluid"),bioFluidOther=!$("#bioFluid").disabled&&val("#bioFluid")==="Others"?val("#bioFluidOther").trim():"";if(bioYN==='Yes'&&!bioType)return alert('Specify biomarker type.'),null;if(bioYN==='Yes'&&!bioFluid)return alert('Specify biological sample.'),null;const cultDone=val("#cultDone")||"",cultType=$("#cultType").disabled?"":val("#cultType"),cultTypeOther=!$("#cultType").disabled&&val("#cultType")==="Other"?val("#cultTypeOther").trim():"";if(cultDone==='Yes'&&!cultType)return alert('Select culture specimen type.'),null;const abx=[];for(let i=0;i<5;i++){const cls=val(`#abx_${i}_class`),drug=val(`#abx_${i}_drug`),start=val(`#abx_${i}_start`),dose=val(`#abx_${i}_dose`),unit=val(`#abx_${i}_unit`),per=val(`#abx_${i}_perday`),route=val(`#abx_${i}_route`),dp=val(`#abx_${i}_diagP`),ds=val(`#abx_${i}_diagS`),dsub=val(`#abx_${i}_diagSub`),ind=val(`#abx_${i}_ind`),hai=val(`#abx_${i}_hai`),rsn=val(`#abx_${i}_reason`),guide=val(`#abx_${i}_guide`),stop=val(`#abx_${i}_stop`),miss=val(`#abx_${i}_miss`)||"0",mwhy=val(`#abx_${i}_missWhy`),treat=val(`#abx_${i}_treat`);const any=[drug,start,dose,unit,per,route,dp,ind,treat].some(v=>(v??"")!="");if(!any)continue;if(!cls)return alert(`Antimicrobial ${i+1}: select Monitored/Restricted.`),null;if(!drug)return alert(`Antimicrobial ${i+1}: select drug.`),null;if(!start)return alert(`Antimicrobial ${i+1}: start date is required.`),null;if(!dose||+dose<=0)return alert(`Antimicrobial ${i+1}: enter positive unit dose.`),null;if(!unit)return alert(`Antimicrobial ${i+1}: select dose unit.`),null;if(!per||+per<=0)return alert(`Antimicrobial ${i+1}: doses/day must be > 0.`),null;if(!route)return alert(`Antimicrobial ${i+1}: select route.`),null;if(!dp)return alert(`Antimicrobial ${i+1}: diagnosis required.`),null;if(dp==='Therapeutic'&&!ds)return alert(`Antimicrobial ${i+1}: select system/site.`),null;if(dp==='Therapeutic'&&(THER[ds]||[]).length&&!dsub)return alert(`Antimicrobial ${i+1}: select sub-site.`),null;if(!ind)return alert(`Antimicrobial ${i+1}: indication type required.`),null;if(ind==='Healthcare Associated Infection'&&!hai)return alert(`Antimicrobial ${i+1}: choose HAI subtype.`),null;if(!rsn)return alert(`Antimicrobial ${i+1}: Reason in note required.`),null;if(!guide)return alert(`Antimicrobial ${i+1}: Guidelines Compliance required.`),null;if(!treat)return alert(`Antimicrobial ${i+1}: Treatment (Empirical/Targeted) required.`),null;if(+miss>0&&!mwhy)return alert(`Antimicrobial ${i+1}: select reason for missed doses.`),null;abx.push({class:cls,drug,startDate:start,unitDose:+dose,unit,dosesPerDay:+per,route,diagnosis:dp,systemSite:ds||"",subSite:dsub||"",indication:ind,haiSubtype:ind==='Healthcare Associated Infection'?hai:"",reasonInNote:rsn,guidelinesCompliance:guide,stopReviewDocumented:stop,missedN:+miss,missedReason:mwhy||"",treatment:treat})}if(!abx.length)return alert('Enter at least one antimicrobial card.'),null;const micro=[];for(let i=0;i<3;i++){const o=val(`#micro_${i}_org`).trim(),r=val(`#micro_${i}_res`),n=val(`#micro_${i}_note`).trim();if(o||r||n)micro.push({organism:o,resistance:r,note:n})}return{formType:"AMS Audit",audit,patient:{hospNo:val('#hospNo').trim(),ageYears:years,ageMonths:months,ageDays:days},tests:{biomarkerUsed:bioYN,biomarkerType:bioType,fluidSample:bioFluid,biomarkerTypeOther:bioTypeOther,fluidSampleOther:bioFluidOther,cultureDone:cultDone,cultureSpecimen:cultType,cultureSpecimenOther:cultTypeOther},history:{prevHosp3mo:val('#prevHosp')||"",prevAbx1mo:val('#prevAbx')||""},antimicrobials:abx,microorganisms:micro}}function submit(){const p=payload();if(!p)return;const frm=document.createElement('form');frm.method='POST';frm.action=URL;let iframe=document.getElementById('gsheet_iframe');if(!iframe){iframe=document.createElement('iframe');iframe.name='gsheet_iframe';iframe.id='gsheet_iframe';iframe.style.display='none';document.body.appendChild(iframe);}frm.target='gsheet_iframe';const fld=(n,v)=>{const i=document.createElement('input');i.type='hidden';i.name=n;i.value=v;return i};frm.appendChild(fld('payload',JSON.stringify(p)));frm.appendChild(fld('source','canvas-form'));document.body.appendChild(frm);try{frm.submit();alert('Submitted.');}finally{setTimeout(()=>{try{frm.remove();}catch(_){}} ,500);} }
function showPreview(){const p=payload();if(!p)return;document.getElementById('ovpre').textContent=JSON.stringify(p,null,2);document.getElementById('ov').classList.remove('hidden')}function misc(){document.getElementById('reset').addEventListener('click',()=>confirm('Clear all fields?')&&location.reload());['#submit','#submit2'].forEach(s=>$(s).addEventListener('click',submit));document.getElementById('preview').addEventListener('click',showPreview);document.getElementById('ovx').addEventListener('click',()=>document.getElementById('ov').classList.add('hidden'))}function init(){SCHEMA.forEach(s=>{const g=$(s.sec);if(!g)return;s.rows.forEach(r=>g.appendChild(field(r)))});document.getElementById('date').value=today();const abx=document.getElementById('abx');for(let i=0;i<5;i++)abx.appendChild(card(i));const m=document.getElementById('micro');for(let i=0;i<3;i++)m.appendChild(mcard(i));areaInit();biomarkerWire();cultureWire();misc();tests()}init()})();</script></body></html>
